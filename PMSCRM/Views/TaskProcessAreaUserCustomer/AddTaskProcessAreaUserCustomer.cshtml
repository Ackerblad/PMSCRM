@model PMSCRM.ViewModels.TaskProcessAreaUserCustomerViewModel

<div class="card shadow-sm p-4 mb-4">
    <!-- Existing TaskProcessAreas -->
    <label class="form-label">Select Process</label>
    <table class="table table-sm table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th class="text-center">Area</th>
                <th class="text-center">Process</th>
                <th class="text-center">Task</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.ExistingConnections != null && Model.ExistingConnections.Any())
            {
                foreach (var item in Model.ExistingConnections)
                {
                    <tr data-task-process-area-id="@item.TaskProcessAreaId" class="selectable-row" style="cursor:pointer;">
                        <td class="text-center small">@item.AreaName</td>
                        <td class="text-center small">@item.ProcessName</td>
                        <td class="text-center small">@item.TaskName</td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td colspan="4" class="text-center small">No Task Process Areas found.</td>
                </tr>
            }
        </tbody>
    </table>

    <form asp-action="AddTaskProcessAreaUserCustomer" method="post">
        <input type="hidden" id="SelectedTaskProcessAreaId" name="TaskProcessAreaId" />

        <div class="mb-3">
            <label for="UserId" class="form-label">Select User</label>
            <select asp-for="UserId" asp-items="Model.Users" class="form-select" required>
                <option value="">Choose a user...</option>
            </select>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please select a user.</div>
        </div>

        <div class="mb-3">
            <label for="CustomerId" class="form-label">Select Customer</label>
            <select asp-for="CustomerId" asp-items="Model.Customers" class="form-select" required>
                <option value="">Choose a customer...</option>
            </select>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please select a customer.</div>
        </div>

        <div class="mb-3">
            <label for="StartDate" class="form-label">Start Date</label>
            <input asp-for="StartDate" type="datetime-local" class="form-control" required />
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please provide a start date.</div>
        </div>

        <div class="mb-3">
            <label for="EndDate" class="form-label">End Date</label>
            <input asp-for="EndDate" type="datetime-local" class="form-control" required />
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please provide an end date.</div>
        </div>

        <div class="mb-3">
            <label for="Status" class="form-label">Status</label>
            <select asp-for="Status" asp-items="Model.Statuses" class="form-select" required>
                <option value="">Choose a status...</option>
            </select>
            <div class="valid-feedback">Valid.</div>
            <div class="invalid-feedback">Please select a status.</div>
        </div>

        <button type="submit" class="btn btn-primary mt-3">Submit</button>
    </form>

    <script>
        document.querySelectorAll('.selectable-row').forEach(row => {
            row.addEventListener('click', function () {
                document.querySelectorAll('.selectable-row').forEach(r => r.classList.remove('table-active'));
                this.classList.add('table-active');
                document.getElementById('SelectedTaskProcessAreaId').value = this.dataset.taskProcessAreaId;
            });
        });
    </script>
</div>
